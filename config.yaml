mixed-port: 7890
allow-lan: true
bind-address: "*"
mode: rule
log-level: info
clash-for-android:
    append-system-dns: false
unified-delay: true
keep-alive-interval: 15

hosts:
    mtalk.google.com: 108.177.125.188

dns:
    enable: true
    ipv6: false
    listen: '127.0.0.1:53'
    default-nameserver: [223.5.5.5, 119.29.29.29]
    enhanced-mode: fake-ip
    fake-ip-range: 198.18.0.1/16
    use-hosts: true
    
    # 强制使用可信 DNS
    nameserver-policy:
      +.google.com: 'https://1.1.1.1/dns-query'
      +.googleapis.com: 'https://1.1.1.1/dns-query'
      +.gstatic.com: 'https://1.1.1.1/dns-query'
      +.googleusercontent.com: 'https://1.1.1.1/dns-query'
      +.github.com: 'https://1.1.1.1/dns-query'
      +.anthropic.com: 'https://1.1.1.1/dns-query'
      +.openai.com: 'https://1.1.1.1/dns-query'
    
    # 主 DNS 服务器
    nameserver: 
      - 'https://223.5.5.5/dns-query'
      - 'https://119.29.29.29/dns-query'
      - 'https://223.6.6.6/dns-query'
    
    # 备用 DNS
    fallback: 
      - 'https://1.1.1.1/dns-query'
      - 'https://8.8.8.8/dns-query'
      - 'https://208.67.220.220/dns-query'
    
    fallback-filter:
      geoip: true
      geoip-code: CN
      ipcidr:
        - 240.0.0.0/4
        - 0.0.0.0/32
      domain:
        - +.google.com
        - +.googleapis.com
        - +.gstatic.com
        - +.googleusercontent.com
        - +.github.com
        - +.anthropic.com
        - +.openai.com
        - +.jsdelivr.net
    
    # 直连 DNS
    direct-nameserver:
      - 223.5.5.5
      - 119.29.29.29

proxies:
  - name: "trojan"
    type: trojan
    server: 43.132.197.237
    port: 4433
    password: 141516
    sni: test.xueshaobo.top

# 订阅配置
proxy-providers:
  FeiniaoYun:
    type: http
    path: ./profiles/proxies/feiniaoyun.yaml
    url: https://x1.344211.cc/api/v1/client/subscribe?token=97d6d41bdc126c7d14c39558ee2a5b3c
    filter: '(日本|JP|Japan|东京|Tokyo|大阪|Osaka|韩国|KR|Korea|Seoul|新加坡|SG|Singapore|台湾|TW|Taiwan|台北)'
    exclude-filter: '学术|不保证可用'
    interval: 7200
    health-check:
      enable: true
      url: http://cp.cloudflare.com/generate_204
      interval: 300
      timeout: 2000
      lazy: false

  FeiniaoYun_Japan:
    type: http
    path: ./profiles/proxies/feiniaoyun_Japan.yaml
    url: https://v1.tlsa.top/link/ifxzP3nhohe3KP2T1vak4vW1ju9UyybXhk01?clash=1
    filter: "(?i)日本"
    exclude-filter: '[235]\.0x|[235]倍率'
    interval: 7200
    health-check:
      enable: true
      url: http://cp.cloudflare.com/generate_204
      interval: 300
      timeout: 2000
      lazy: false

  FeiniaoYun_Korea:
    type: http
    path: ./profiles/proxies/feiniaoyun_Korea.yaml
    url: https://v1.tlsa.top/link/ifxzP3nhohe3KP2T1vak4vW1ju9UyybXhk01?clash=1
    filter: "(?i)韩国"
    exclude-filter: '[235]\.0x|[235]倍率'
    interval: 7200
    health-check:
      enable: true
      url: http://cp.cloudflare.com/generate_204
      interval: 300
      timeout: 2000
      lazy: false

  FeiniaoYun_Singapore:
    type: http
    path: ./profiles/proxies/feiniaoyun_Singapore.yaml
    url: https://v1.tlsa.top/link/ifxzP3nhohe3KP2T1vak4vW1ju9UyybXhk01?clash=1
    filter: "(?i)新加坡"
    exclude-filter: '[235]\.0x|[235]倍率'
    interval: 7200
    health-check:
      enable: true
      url: http://cp.cloudflare.com/generate_204
      interval: 300
      timeout: 2000
      lazy: false

  Nolock:
    type: http
    path: ./profiles/proxies/nolock.yaml
    url: https://47.116.124.118:8090/sub/14581/xopinnjo/clashxpro
    filter: '^(?!.*(2\.0x|3\.0x|5\.0x|2倍率|3倍率|5倍率)).*$'
    interval: 7200
    health-check:
      enable: true
      url: http://cp.cloudflare.com/generate_204
      interval: 300
      timeout: 2000
      lazy: false
  
  Nolock_Singapore:
    type: http
    path: ./profiles/proxies/nolock_Singapore.yaml
    url: https://47.116.124.118:8090/sub/14581/xopinnjo/clashxpro
    filter: '新加坡'
    exclude-filter: '[235]\.0x|[235]倍率'
    interval: 7200
    health-check:
      enable: true
      url: http://cp.cloudflare.com/generate_204
      interval: 300
      timeout: 2000
      lazy: false

  Nolock_Korea:
    type: http
    path: ./profiles/proxies/nolock_Korea.yaml
    url: https://47.116.124.118:8090/sub/14581/xopinnjo/clashxpro
    filter: '韩国'
    exclude-filter: '[235]\.0x|[235]倍率'
    interval: 7200
    health-check:
      enable: true
      url: http://cp.cloudflare.com/generate_204
      interval: 300
      timeout: 2000
      lazy: false

  Nolock_Japan:
    type: http
    path: ./profiles/proxies/nolock_Japan.yaml
    url: https://47.116.124.118:8090/sub/14581/xopinnjo/clashxpro
    filter: '日本'
    exclude-filter: '[235]\.0x|[235]倍率'
    interval: 7200
    health-check:
      enable: true
      url: http://cp.cloudflare.com/generate_204
      interval: 300
      timeout: 2000
      lazy: false

  V2Free:
    type: http
    path: ./profiles/proxies/v2free.yaml
    url: https://v1.tlsa.top/link/ifxzP3nhohe3KP2T1vak4vW1ju9UyybXhk01?clash=1
    # filter: '^(?!.*(2\.0x|3\.0x|5\.0x|2倍率|3倍率|5倍率)).*$'
    filter: '(日本|JP|Japan|东京|Tokyo|大阪|Osaka|韩国|KR|Korea|Seoul|新加坡|SG|Singapore|台湾|TW|Taiwan|台北)'
    exclude-filter: '学术|不保证可用'
    interval: 7200
    health-check:
      enable: true
      url: http://cp.cloudflare.com/generate_204
      interval: 300
      timeout: 2000
      lazy: false

  V2Free_Japan:
    type: http
    path: ./profiles/proxies/v2free_Japan.yaml
    url: https://v1.tlsa.top/link/ifxzP3nhohe3KP2T1vak4vW1ju9UyybXhk01?clash=1
    filter: "(?i)日本"
    exclude-filter: '[235]\.0x|[235]倍率'
    interval: 7200
    health-check:
      enable: true
      url: http://cp.cloudflare.com/generate_204
      interval: 300
      timeout: 2000
      lazy: false

  V2Free_Korea:
    type: http
    path: ./profiles/proxies/v2free_Korea.yaml
    url: https://v1.tlsa.top/link/ifxzP3nhohe3KP2T1vak4vW1ju9UyybXhk01?clash=1
    filter: "(?i)韩国"
    exclude-filter: '[235]\.0x|[235]倍率'
    interval: 7200
    health-check:
      enable: true
      url: http://cp.cloudflare.com/generate_204
      interval: 300
      timeout: 2000
      lazy: false

  V2Free_Singapore:
    type: http
    path: ./profiles/proxies/v2free_Singapore.yaml
    url: https://v1.tlsa.top/link/ifxzP3nhohe3KP2T1vak4vW1ju9UyybXhk01?clash=1
    filter: "(?i)新加坡"
    exclude-filter: '[235]\.0x|[235]倍率'
    interval: 7200
    health-check:
      enable: true
      url: http://cp.cloudflare.com/generate_204
      interval: 300
      timeout: 2000
      lazy: false

# 策略组配置 - 核心优化部分
proxy-groups:
  # ========== 主节点池(自动选择最快) ==========
  - name: Auto-FeiniaoYun
    type: url-test
    url: http://cp.cloudflare.com/generate_204
    interval: 120
    tolerance: 50
    timeout: 2000
    lazy: false
    use:
      - FeiniaoYun

  - name: Auto-Nolock
    type: url-test
    url: http://cp.cloudflare.com/generate_204
    interval: 120
    tolerance: 50
    timeout: 2000
    lazy: false
    use:
      - Nolock

  - name: Auto-V2Free
    type: url-test
    url: http://cp.cloudflare.com/generate_204
    interval: 120
    tolerance: 50
    timeout: 2000
    lazy: false
    use:
      - V2Free

  # ========== 故障自动切换(主力代理) ==========
  - name: PROXY
    type: fallback
    url: http://cp.cloudflare.com/generate_204
    interval: 60
    timeout: 2000
    lazy: false
    proxies:
      - Auto-V2Free
      - Auto-Nolock
      - DIRECT

  # ========== 服务器开发专用 ==========
  - name: SERVER
    type: fallback
    url: http://cp.cloudflare.com/generate_204
    interval: 120
    timeout: 2000
    lazy: false
    proxies:
      - Auto-V2Free
      - Auto-Nolock

  # ========== 通用代理(不使用 trojan) ==========
  - name: PROXY_COMMON
    type: fallback
    url: http://cp.cloudflare.com/generate_204
    interval: 90
    timeout: 2000
    lazy: false
    proxies:
      - Auto-FeiniaoYun
      - Auto-V2Free
      - Auto-Nolock

  # ========== AI 服务专用(亚洲低延迟节点) ==========
  - name: AI-Singapore
    type: url-test
    url: http://cp.cloudflare.com/generate_204
    interval: 120
    tolerance: 100
    timeout: 3000
    lazy: false
    use:
      - FeiniaoYun_Singapore
      - V2Free_Singapore
      - Nolock_Singapore

  - name: AI-Japan
    type: url-test
    url: http://cp.cloudflare.com/generate_204
    interval: 120
    tolerance: 100
    timeout: 3000
    lazy: false
    use:
      - FeiniaoYun_Japan
      - V2Free_Japan
      - Nolock_Japan

  - name: AI-Korea
    type: url-test
    url: http://cp.cloudflare.com/generate_204
    interval: 120
    tolerance: 100
    timeout: 3000
    lazy: false
    use:
      - FeiniaoYun_Korea
      - V2Free_Korea
      - Nolock_Korea

  # AI 服务故障转移组
  - name: PROXY_AI
    type: fallback
    url: http://cp.cloudflare.com/generate_204
    interval: 60
    timeout: 3000
    lazy: false
    proxies:
      - AI-Singapore
      - AI-Japan
      - AI-Korea
      - Auto-V2Free

  # ========== 全局手动选择(备用) ==========
  - name: GLOBAL_USE
    type: select
    proxies:
      - PROXY
      - Auto-FeiniaoYun
      - Auto-V2Free
      - Auto-Nolock
      - DIRECT
    use:
      - FeiniaoYun
      - V2Free
      - Nolock

# 规则集配置
rule-providers:
  proxy: 
    type: http
    behavior: domain
    url: 'https://47.116.124.118:9090/rules/clash/proxy.txt'
    path: ./ruleset/proxy.yaml
    interval: 86400
  
  direct: 
    type: http
    behavior: domain
    url: 'https://47.116.124.118:9090/rules/clash/direct.txt'
    path: ./ruleset/direct.yaml
    interval: 86400
  
  apple: 
    type: http
    behavior: domain
    url: 'https://47.116.124.118:9090/rules/clash/apple.txt'
    path: ./ruleset/apple.yaml
    interval: 86400
  
  cncidr: 
    type: http
    behavior: domain
    url: 'https://47.116.124.118:9090/rules/clash/cncidr.txt'
    path: ./ruleset/cncidr.yaml
    interval: 86400
  
  gfw: 
    type: http
    behavior: domain
    url: 'https://47.116.124.118:9090/rules/clash/gfw.txt'
    path: ./ruleset/gfw.yaml
    interval: 86400
  
  telegram: 
    type: http
    behavior: classical
    url: 'https://47.116.124.118:9090/rules/clash/telegram.txt'
    path: ./ruleset/telegram.yaml
    interval: 86400
  
  customrule: 
    type: http
    behavior: classical
    url: 'https://47.116.124.118:9090/rules/clash/customrule.txt'
    path: ./ruleset/customrule.yaml
    interval: 86400
  
  localnetwork: 
    type: http
    behavior: classical
    url: 'https://47.116.124.118:9090/rules/clash/localnetwork.txt'
    path: ./ruleset/localnetwork.yaml
    interval: 86400

  # 广告拦截规则
  AD:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/earoftoast/clash-rules/main/AD.yaml"
    path: ./rules/AD.yaml
    interval: 86400
    
  EasyList:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/earoftoast/clash-rules/main/EasyList.yaml"
    path: ./rules/EasyList.yaml
    interval: 86400
    
  EasyListChina:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/earoftoast/clash-rules/main/EasyListChina.yaml"
    path: ./rules/EasyListChina.yaml
    interval: 86400

  EasyPrivacy:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/earoftoast/clash-rules/main/EasyPrivacy.yaml"
    path: ./rules/EasyPrivacy.yaml
    interval: 86400

  ProgramAD:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/earoftoast/clash-rules/main/ProgramAD.yaml"
    path: ./rules/ProgramAD.yaml
    interval: 86400

  ProcessReject:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/zhangdengjie/clash-rules/main/ProcessReject.yaml"
    path: ./rules/ProcessReject.yaml
    interval: 86400

  ProcessAI:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/zhangdengjie/clash-rules/main/ProcessAI.yaml"
    path: ./rules/ProcessAI.yaml
    interval: 86400

# 路由规则
rules:
    # ========== 高优先级直连 ==========
    - DOMAIN,bugly.qq.com,DIRECT
    - DOMAIN,cas.bugly.qq.com,DIRECT
    - DOMAIN,dl.google.com,DIRECT
    - DOMAIN,x1.344211.cc,DIRECT
    - DOMAIN,safebrowsing.urlsec.qq.com,DIRECT
    - DOMAIN,safebrowsing.googleapis.com,DIRECT

    
    # ========== AI 服务(最高优先级) ==========
    - DOMAIN,playconsoleapps-pa.clients6.google.com,PROXY_AI
    - DOMAIN,gemini.google.com,PROXY_AI
    - DOMAIN-SUFFIX,googleapis.com,PROXY_AI
    - DOMAIN-SUFFIX,anthropic.com,PROXY_AI
    - DOMAIN-SUFFIX,claude.ai,PROXY_AI
    - DOMAIN-SUFFIX,openai.com,PROXY_AI
    - DOMAIN-SUFFIX,chatgpt.com,PROXY_AI
    - DOMAIN-SUFFIX,sora.com,PROXY_AI
    - DOMAIN-SUFFIX,auth0.com,PROXY_AI
    - DOMAIN-SUFFIX,dola.com,PROXY_AI
    - DOMAIN-SUFFIX,ciciai.com,PROXY_AI
    - DOMAIN-SUFFIX,deepl.com,PROXY_AI
    - DOMAIN-SUFFIX,codeium.com,PROXY_AI
    - DOMAIN-SUFFIX,cdn.oaistatic.com,PROXY_AI
    - DOMAIN,cdn.usefathom.com,PROXY_AI
    - DOMAIN,api.fast.com,PROXY_AI
    
    # ========== 广告拦截 ==========
    - DOMAIN,lcs1.gateway.tencent.com,REJECT
    - DOMAIN-KEYWORD,wps,REJECT
    - RULE-SET,AD,REJECT
    - RULE-SET,EasyList,REJECT
    - RULE-SET,EasyListChina,REJECT
    - RULE-SET,EasyPrivacy,REJECT
    - RULE-SET,ProgramAD,REJECT
    - RULE-SET,ProcessReject,REJECT
    - DOMAIN-SUFFIX,vox.rocks,REJECT
    
    # ========== 开发工具相关 ==========
    - DOMAIN-KEYWORD,ubuntu,SERVER
    - DOMAIN-KEYWORD,docker,SERVER
    - DOMAIN-SUFFIX,mvnrepository.com,SERVER
    
    # ========== 进程规则(macOS) ==========
    - PROCESS-NAME,Xmind,REJECT
    - PROCESS-NAME,Xmind Helper,REJECT
    - PROCESS-NAME,Cici,PROXY_AI
    - PROCESS-NAME,Dola Helper,PROXY_AI
    - PROCESS-NAME,studio,PROXY_COMMON
    - PROCESS-NAME,Docker Desktop Helper,SERVER
    - PROCESS-NAME,com.docker.backend,SERVER
    - PROCESS-NAME,ollama,SERVER
    
    # 代理工具直连
    - PROCESS-NAME,trustd,DIRECT
    - PROCESS-NAME,apsd,DIRECT
    - PROCESS-NAME,v2ray,DIRECT
    - PROCESS-NAME,Surge%203,DIRECT
    - PROCESS-NAME,ss-local,DIRECT
    - PROCESS-NAME,privoxy,DIRECT
    - PROCESS-NAME,trojan,DIRECT
    - PROCESS-NAME,trojan-go,DIRECT
    - PROCESS-NAME,naive,DIRECT
    - PROCESS-NAME,WeChat,DIRECT
    
    # 下载工具直连
    - PROCESS-NAME,Thunder,DIRECT
    - PROCESS-NAME,DownloadService,DIRECT
    - PROCESS-NAME,qBittorrent,DIRECT
    - PROCESS-NAME,Transmission,DIRECT
    - PROCESS-NAME,fdm,DIRECT
    - PROCESS-NAME,aria2c,DIRECT
    - PROCESS-NAME,Folx,DIRECT
    - PROCESS-NAME,NetTransport,DIRECT
    - PROCESS-NAME,uTorrent,DIRECT
    - PROCESS-NAME,WebTorrent,DIRECT
    
    # ========== 常用域名 ==========
    - DOMAIN-SUFFIX,google.com,PROXY_COMMON
    - DOMAIN-SUFFIX,cloudflare.com,PROXY_COMMON
    - DOMAIN-SUFFIX,wangchujiang.com,PROXY
    - DOMAIN-SUFFIX,com.larus.wolf,PROXY_AI
    
    # ========== 规则集匹配 ==========
    - RULE-SET,customrule,DIRECT
    - RULE-SET,apple,DIRECT
    - RULE-SET,direct,DIRECT
    - RULE-SET,cncidr,DIRECT
    - RULE-SET,localnetwork,DIRECT
    - RULE-SET,proxy,PROXY_COMMON
    - RULE-SET,gfw,PROXY_COMMON
    - RULE-SET,telegram,PROXY_COMMON
    
    # ========== 地理位置匹配 ==========
    - GEOIP,LAN,DIRECT
    - GEOIP,CN,DIRECT
    
    # ========== 兜底规则 ==========
    - MATCH,PROXY
