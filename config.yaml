mixed-port: 7890
allow-lan: true
bind-address: "*"
mode: rule
log-level: info
ipv6: false # 建议关闭 IPv6，防止国内环境下的路由黑洞和DNS泄露问题
clash-for-android:
    append-system-dns: false
unified-delay: true
keep-alive-interval: 30 # 延长保活时间，减少移动端断连

hosts:
    mtalk.google.com: 108.177.125.188

dns:
    enable: true
    ipv6: false
    listen: '127.0.0.1:53'
    # 默认国内解析：加入 UDP 协议以提高首次启动速度
    default-nameserver: 
      - 223.5.5.5
      - 119.29.29.29
    # 解析节点域名的 DNS
    proxy-server-nameserver: 
      - 223.5.5.5
      - 119.29.29.29
    enhanced-mode: fake-ip
    fake-ip-range: 198.18.0.1/16
    use-hosts: true
    
    nameserver-policy:
      +.google.com: 'https://1.1.1.1/dns-query'
      +.googleapis.com: 'https://1.1.1.1/dns-query'
      +.gstatic.com: 'https://1.1.1.1/dns-query'
      +.googleusercontent.com: 'https://1.1.1.1/dns-query'
      +.github.com: 'https://1.1.1.1/dns-query'
      +.anthropic.com: 'https://1.1.1.1/dns-query'
      +.openai.com: 'https://1.1.1.1/dns-query'
    
    nameserver: 
      # 混合使用 UDP 和 DoH，解决冷启动慢的问题
      - 223.5.5.5
      - 119.29.29.29
      - 'https://223.5.5.5/dns-query'
      - 'https://223.5.5.5/dns-query'
      - 'https://119.29.29.29/dns-query'
      - 'https://1.12.12.12/dns-query'
    
    fallback: 
      - 'https://1.1.1.1/dns-query'
      - 'https://8.8.8.8/dns-query'
      - 'tcp://208.67.220.220:443'
    
    fallback-filter:
      geoip: true
      geoip-code: CN
      ipcidr:
        - 240.0.0.0/4
        - 0.0.0.0/32
      domain:
        - +.google.com
        - +.googleapis.com
        - +.gstatic.com
        - +.googleusercontent.com
        - +.github.com
        - +.anthropic.com
        - +.openai.com
    
    direct-nameserver:
      - 223.5.5.5
      - 119.29.29.29

# 订阅配置
proxy-providers:
  # 使用订阅转换服务，只提取节点部分
  FeiniaoYun:
    type: http
    # base64 类型，转换链接
    url: https://sub.xeton.dev/sub?target=clash&url=https://x1.344211.cc/api/v1/client/subscribe?token=97d6d41bdc126c7d14c39558ee2a5b3c&insert=false&emoji=false&udp=true&list=false
    interval: 3600
    path: ./providers/feiniaoyun.yaml
    filter: '(?i)(日本|JP|Japan|东京|Tokyo|大阪|Osaka|韩国|KR|Korea|Seoul|新加坡|SG|Singapore|台湾|TW|Taiwan|台北|香港|HK)'
    exclude-filter: '(?i)(学术|不保证可用|到期|剩余|流量)'
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true

  V2Free:
    type: http
    path: ./profiles/proxies/v2free.yaml
    url: https://v1.tlsa.top/link/ifxzP3nhohe3KP2T1vak4vW1ju9UyybXhk01?clash=1
    filter: '(?i)(日本|JP|Japan|东京|Tokyo|大阪|Osaka|韩国|KR|Korea|Seoul|新加坡|SG|Singapore|台湾|TW|Taiwan|台北)'
    exclude-filter: '(?i)(学术|不保证可用|到期|剩余|流量)'
    interval: 7200
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true

  V2Free_Japan:
    type: http
    path: ./profiles/proxies/v2free_Japan.yaml
    url: https://v1.tlsa.top/link/ifxzP3nhohe3KP2T1vak4vW1ju9UyybXhk01?clash=1
    filter: "(?i)日本"
    exclude-filter: '[235]\.0x|[235]倍率'
    interval: 7200
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true

  V2Free_Korea:
    type: http
    path: ./profiles/proxies/v2free_Korea.yaml
    url: https://v1.tlsa.top/link/ifxzP3nhohe3KP2T1vak4vW1ju9UyybXhk01?clash=1
    filter: "(?i)韩国"
    exclude-filter: '[235]\.0x|[235]倍率'
    interval: 7200
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true

  V2Free_Singapore:
    type: http
    path: ./profiles/proxies/v2free_Singapore.yaml
    url: https://v1.tlsa.top/link/ifxzP3nhohe3KP2T1vak4vW1ju9UyybXhk01?clash=1
    filter: "(?i)新加坡"
    exclude-filter: '[235]\.0x|[235]倍率'
    interval: 7200
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true

# use → 只能接 provider
# proxies → 只能接 proxy / proxy-group
# 策略组配置
proxy-groups:
  - name: Auto-Feiniaoyun
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 100
    timeout: 5000
    lazy: true
    use:
      - FeiniaoYun

  - name: Auto-V2Free
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 100
    timeout: 5000
    lazy: true
    use:
      - V2Free

  - name: SERVER
    type: fallback
    url: http://www.gstatic.com/generate_204
    interval: 300
    timeout: 5000
    tolerance: 100
    lazy: true
    proxies:
      - Auto-V2Free
      - Auto-Feiniaoyun

  - name: PROXY_COMMON
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 180
    timeout: 5000
    tolerance: 100
    lazy: true
    proxies:
      - Auto-V2Free
      - Auto-Feiniaoyun

  - name: AI-Singapore
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 100
    timeout: 5000
    lazy: true
    use:
      - V2Free_Singapore
    proxies:
      - Auto-Feiniaoyun

  - name: AI-Japan
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 100
    timeout: 5000
    lazy: true
    use:
      - V2Free_Japan
    proxies:
      - Auto-Feiniaoyun

  - name: AI-Korea
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 100
    timeout: 5000
    lazy: true
    use:
      - V2Free_Korea
    proxies:
      - Auto-Feiniaoyun

  - name: PROXY_AI
    type: select
    url: http://www.gstatic.com/generate_204
    interval: 180
    timeout: 5000
    lazy: true
    proxies:
      - AI-Singapore
      - AI-Japan
      - AI-Korea
      - Auto-Feiniaoyun
      - Auto-V2Free

  - name: GLOBAL_USE
    type: select
    proxies:
      - PROXY_COMMON
      - Auto-V2Free
      - Auto-Feiniaoyun
      - DIRECT
    use:
      - V2Free
      - FeiniaoYun

# 规则集配置
rule-providers:
  proxy: 
    type: http
    behavior: domain
    url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt'
    path: ./ruleset/proxy.yaml
    interval: 86400
  
  direct: 
    type: http
    behavior: domain
    url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt'
    path: ./ruleset/direct.yaml
    interval: 86400
  
  apple: 
    type: http
    behavior: domain
    url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt'
    path: ./ruleset/apple.yaml
    interval: 86400
  
  cncidr: 
    type: http
    behavior: ipcidr
    url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt'
    path: ./ruleset/cncidr.yaml
    interval: 86400
  
  gfw: 
    type: http
    behavior: domain
    url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt'
    path: ./ruleset/gfw.yaml
    interval: 86400
  
  telegram: 
    type: http
    behavior: classical
    url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt'
    path: ./ruleset/telegram.yaml
    interval: 86400
  
  customrule: 
    type: http
    behavior: classical
    url: 'https://47.116.124.118:9090/rules/clash/customrule.txt'
    path: ./ruleset/customrule.yaml
    interval: 86400
  
  localnetwork: 
    type: http
    behavior: classical
    url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt'
    path: ./ruleset/localnetwork.yaml
    interval: 86400

  AD:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/earoftoast/clash-rules/main/AD.yaml"
    path: ./rules/AD.yaml
    interval: 86400
    
  EasyList:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/earoftoast/clash-rules/main/EasyList.yaml"
    path: ./rules/EasyList.yaml
    interval: 86400
    
  EasyListChina:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/earoftoast/clash-rules/main/EasyListChina.yaml"
    path: ./rules/EasyListChina.yaml
    interval: 86400

  EasyPrivacy:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/earoftoast/clash-rules/main/EasyPrivacy.yaml"
    path: ./rules/EasyPrivacy.yaml
    interval: 86400

  ProgramAD:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/earoftoast/clash-rules/main/ProgramAD.yaml"
    path: ./rules/ProgramAD.yaml
    interval: 86400

  ProcessReject:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/zhangdengjie/clash-rules/main/ProcessReject.yaml"
    path: ./rules/ProcessReject.yaml
    interval: 86400

  ProcessAI:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/zhangdengjie/clash-rules/main/ProcessAI.yaml"
    path: ./rules/ProcessAI.yaml
    interval: 86400

rules:
    # 强制直连
    - DOMAIN,sub.xeton.dev,DIRECT # 确保订阅转换地址直连
    - DOMAIN,v1.tlsa.top,DIRECT   # 确保订阅地址直连
    - DOMAIN-SUFFIX,cn,DIRECT     # 所有 .cn 域名直连，减少规则匹配开销
    - DOMAIN,bugly.qq.com,DIRECT
    - DOMAIN,cas.bugly.qq.com,DIRECT
    - DOMAIN,dl.google.com,DIRECT
    - DOMAIN,x1.344211.cc,DIRECT
    - DOMAIN,safebrowsing.urlsec.qq.com,DIRECT
    - DOMAIN,safebrowsing.googleapis.com,DIRECT

    # AI 规则
    - DOMAIN,aistudio.google.com,PROXY_AI
    - DOMAIN,ai.google.dev,PROXY_AI
    - DOMAIN,playconsoleapps-pa.clients6.google.com,PROXY_AI
    - DOMAIN,gemini.google.com,PROXY_AI
    - DOMAIN-SUFFIX,googleapis.com,PROXY_AI
    - DOMAIN-SUFFIX,anthropic.com,PROXY_AI
    - DOMAIN-SUFFIX,claude.ai,PROXY_AI
    - DOMAIN-SUFFIX,openai.com,PROXY_AI
    - DOMAIN-SUFFIX,chatgpt.com,PROXY_AI
    - DOMAIN-SUFFIX,sora.com,PROXY_AI
    - DOMAIN-SUFFIX,auth0.com,PROXY_AI
    - DOMAIN-SUFFIX,dola.com,PROXY_AI
    - DOMAIN-SUFFIX,ciciai.com,PROXY_AI
    - DOMAIN-SUFFIX,deepl.com,PROXY_AI
    - DOMAIN-SUFFIX,codeium.com,PROXY_AI
    - DOMAIN-SUFFIX,cdn.oaistatic.com,PROXY_AI
    - DOMAIN,cdn.usefathom.com,PROXY_AI
    - DOMAIN,api.fast.com,PROXY_AI
    - DOMAIN-SUFFIX,x.ai,PROXY_AI
    - DOMAIN-SUFFIX,grok.com,PROXY_AI
    
    - DOMAIN,lcs1.gateway.tencent.com,REJECT
    - DOMAIN-SUFFIX,proxyman.com,REJECT
    - DOMAIN-KEYWORD,wps,REJECT
    - RULE-SET,AD,REJECT
    - RULE-SET,EasyList,REJECT
    - RULE-SET,EasyListChina,REJECT
    - RULE-SET,EasyPrivacy,REJECT
    - RULE-SET,ProgramAD,REJECT
    - RULE-SET,ProcessReject,REJECT
    - DOMAIN-SUFFIX,vox.rocks,REJECT
    
    - DOMAIN-KEYWORD,ubuntu,SERVER
    - DOMAIN-KEYWORD,docker,SERVER
    - DOMAIN-SUFFIX,mvnrepository.com,SERVER
    
    # 进程拒绝规则
    - PROCESS-NAME,QuickRecorder,REJECT
    - PROCESS-NAME,Xmind,REJECT
    - PROCESS-NAME,Xmind Helper,REJECT
    - PROCESS-NAME,Cici,PROXY_AI
    - PROCESS-NAME,Dola Helper,PROXY_AI
    - PROCESS-NAME,studio,PROXY_COMMON
    - PROCESS-NAME,Docker Desktop Helper,SERVER
    - PROCESS-NAME,com.docker.backend,SERVER
    - PROCESS-NAME,ollama,SERVER
    
    # 进程直连规则
    - PROCESS-NAME,trustd,DIRECT
    - PROCESS-NAME,apsd,DIRECT
    - PROCESS-NAME,v2ray,DIRECT
    - PROCESS-NAME,Surge%203,DIRECT
    - PROCESS-NAME,ss-local,DIRECT
    - PROCESS-NAME,privoxy,DIRECT
    - PROCESS-NAME,trojan,DIRECT
    - PROCESS-NAME,trojan-go,DIRECT
    - PROCESS-NAME,naive,DIRECT
    - PROCESS-NAME,WeChat,DIRECT
    - PROCESS-NAME,Thunder,DIRECT
    - PROCESS-NAME,DownloadService,DIRECT
    - PROCESS-NAME,qBittorrent,DIRECT
    - PROCESS-NAME,Transmission,DIRECT
    - PROCESS-NAME,fdm,DIRECT
    - PROCESS-NAME,aria2c,DIRECT
    - PROCESS-NAME,Folx,DIRECT
    - PROCESS-NAME,NetTransport,DIRECT
    - PROCESS-NAME,uTorrent,DIRECT
    - PROCESS-NAME,WebTorrent,DIRECT
    
    - DOMAIN-SUFFIX,google.com,PROXY_AI
    - DOMAIN-SUFFIX,cloudflare.com,PROXY_COMMON
    - DOMAIN-SUFFIX,wangchujiang.com,PROXY_COMMON
    - DOMAIN-SUFFIX,com.larus.wolf,PROXY_AI
    
    - RULE-SET,customrule,DIRECT
    - RULE-SET,apple,DIRECT
    - RULE-SET,direct,DIRECT
    - RULE-SET,cncidr,DIRECT
    - RULE-SET,localnetwork,DIRECT
    - RULE-SET,proxy,PROXY_COMMON
    - RULE-SET,gfw,PROXY_COMMON
    - RULE-SET,telegram,PROXY_COMMON
    
    - GEOIP,LAN,DIRECT
    - GEOIP,CN,DIRECT
    
    - MATCH,PROXY_COMMON
